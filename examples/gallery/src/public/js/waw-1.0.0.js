/**
 * wAw.js micro web framework v1.0.0
 * http://github.com/blambeau/waw.js
 *
 * Copyright 2011, Bernard Lambeau
 * Released under the MIT License
 */var Waw=function(){};(function(a){var b,c;b=[],c=function(c){var d;(d=a[c])!=null?d:a[c]=b[c](a);return a},b["./brick"]=function(a){var b,d,e=Array.prototype.slice;d=c("./signal").Signal,a.Brick=b=function(){function a(a){var b;a==null&&(a={});try{b=this.__proto__.constructor.prototype.defaults,this.options=$.extend({},b,a)}catch(c){this.options=a}}a.prototype._wInit=function(a,b){var c,d,e;a!=null?(this._wRoot=a.wRoot(),this._wParent=a):(this._wRoot=this,this._wParent=null),this._wName=b,this._wQid=this._wParent===null?"/":(d=this._wParent.wQid(),d==="/"?d+this._wName:d+"/"+this._wName);for(c in this){e=this[c];if(c[0]==="_")continue;e!=null&&e._wInit!=null?e._wInit(this,c):e!=null&&e.wInit!=null&&e.wInit(this,c)}if(this.wInit!=null)return this.wInit(a,c)},a.prototype.wInit=function(a,b){var c,d,e,f,g;f=this.options,g=[];for(d in f)e=f[d],c=this._build_function(e),g.push(this[d]=c);return g},a.prototype._build_function=function(a){var b;if(typeof a==="function"){b=this;return function(){return a(b)}}return function(){return a}},a.prototype.wName=function(){return this._wName},a.prototype.wParent=function(){return this._wParent},a.prototype.wRoot=function(){return this._wRoot},a.prototype.wQid=function(){return this._wQid},a.prototype.wRun=function(){return this._wInit(null,"/")},a.prototype.wFetch=function(a,b){var c,d,e;b==null&&(b=0);if(a instanceof Array){d=a[b],c=function(){switch(d){case"/":return this._wRoot;case".":return this;case"..":return this._wParent;default:return this[d]}}.call(this);if(c!=null){if(a.length-1===b)return c;if(c.wFetch!=null)return c.wFetch(a,b+1);throw"Not a waw brick under "+a.join("/")+" ("+d+"), unable to fetch"}throw"No such key "+a[b]}if(a==="/")return this._wRoot;e=a.split("/"),e[0]===""&&(e[0]="/");return this.wFetch(e,0)},a.prototype.wGet=function(a){var b;b=this.wFetch(a);if(b!=null&&b.get!=null)return b.get();throw"Not gettable "+a},a.prototype.wSet=function(a,b){var c;c=this.wFetch(a);if(c!=null&&c.set!=null)return c.set(b);throw"Not settable "+a},a.prototype.wListen=function(a,b){var c;c=this.wFetch(a);if(c!=null&&c.listen!=null)c.listen(b);else throw"Not a listenable "+c;return this},a.prototype.wEmit=function(){var a,b,c;c=arguments[0],a=2<=arguments.length?e.call(arguments,1):[],b=this.wFetch(c);if(b!=null&&b.emit!=null)b.emit.apply(b,a);else throw"Not an emittable "+b;return this},a.prototype.wCall=function(a,b){var c;c=this.wFetch(a);if(c!=null)return b.apply(c);throw"Not found "+a};return a}()},b["./cell"]=function(a){var b,d,e,f=Object.prototype.hasOwnProperty,g=function(a,b){function d(){this.constructor=a}for(var c in b)f.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype;return a};b=c("./brick").Brick,e=c("./signal").Signal,a.Cell=d=function(){function a(b){this.value=b,a.__super__.constructor.apply(this,arguments),this.changed=new e(this)}g(a,b),a.prototype.get=function(){return this.value},a.prototype.set=function(a){var b;b=this.value,this.value=a,this.changed.emit(this,b,a);return this.value},a.prototype.listen=function(a){return this.wListen("changed",a)},a.prototype.toString=function(){var a;a=this.get();return a!=null?a.toString():null};return a}()},b["./helpers"]=function(a){var b,c=Array.prototype.slice;a.Helpers=b=function(){function a(){}a.prototype.wRun=function(a){a.wRun();return $.wApp=a},a.prototype.wFetch=function(a){return $.wApp.wFetch(a)},a.prototype.wGet=function(a){return $.wApp.wGet(a)},a.prototype.wSet=function(a,b){return $.wApp.wSet(a,fn)},a.prototype.wListen=function(a,b){return $.wApp.wListen(a,b)},a.prototype.wEmit=function(){var a,b,d;b=arguments[0],a=2<=arguments.length?c.call(arguments,1):[];return(d=$.wApp).wEmit.apply(d,[b].concat(c.call(a)))},a.prototype.wConnect=function(a,b){return a.listen(b)},a.prototype.wCall=function(a,b){return $.wApp.wCall(a,b)};return a}()},b["./signal"]=function(a){var b;a.Signal=b=function(){function a(a){this.brick=a,this.listeners=[]}a.prototype.listen=function(a){this.listeners.push(a);return this},a.prototype.emit=function(){var a,b,c,d,e;d=this.listeners,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.apply(null,arguments));return e};return a}()},b["./sm"]=function(a){var b,d,e,f=Object.prototype.hasOwnProperty,g=function(a,b){function d(){this.constructor=a}for(var c in b)f.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype;return a},h=Array.prototype.slice,i=function(a,b){return function(){return a.apply(b,arguments)}};b=c("./cell").Cell,e=c("./signal").Signal,a.SM=d=function(){function a(b){this.def=b,a.__super__.constructor.apply(this,arguments),this.set(null)}g(a,b),a.prototype.value_for=function(a){return this.def[a]},a.prototype.wInit=function(a,b){var c,d,e;e=this.def;for(c in e)d=e[c],this.wListen(c,this._build_fn(c,d));return this},a.prototype._build_fn=function(a,b){return typeof b==="function"?i(function(){var a;a=arguments,arguments=1<=a.length?h.call(a,0):[];return this.set(b.apply(null,arguments))},this):i(function(){var a;a=arguments,arguments=1<=a.length?h.call(a,0):[];return this.set(b)},this)};return a}()},b["./view"]=function(a){var b,d,e=function(a,b){return function(){return a.apply(b,arguments)}},f=Object.prototype.hasOwnProperty,g=function(a,b){function d(){this.constructor=a}for(var c in b)f.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype;return a};b=c("./brick").Brick,a.View=d=function(){function a(b){this._buildPartial=e(this._buildPartial,this),this._normalizePartials=e(this._normalizePartials,this),this.mustacheRender=e(this.mustacheRender,this),this.wCallRenderer=e(this.wCallRenderer,this),this.toString=e(this.toString,this),this.refresh=e(this.refresh,this),a.__super__.constructor.apply(this,arguments),this._normalizePartials(b)}g(a,b),a.prototype.defaults={url:function(a){return a.renderScope().wQid()+"/"+a.wName()},selector:function(a){return"#"+a.wName()},template:function(a){var b;return(b=a._template)!=null?b:a._template=$.ajax({url:a.url(),async:!1}).responseText},handler:"server",renderScope:function(a){return a.wParent()},renderData:{},partials:[],render:function(a){switch(a.handler()){case"server":return $.ajax({url:a.url(),async:!1}).responseText;case"mustache":return a.mustacheRender()}}},a.prototype.wInit=function(b,c){return a.__super__.wInit.apply(this,arguments)},a.prototype.refresh=function(){var a;a=this.selector();return $(a).replaceWith(this.toString())},a.prototype.toString=function(){return this.render().toString()},a.prototype.wCallRenderer=function(a,b){var c;c=b(a),c[c.length-1]!==")"&&(c+="()"),c="function(){ this."+c+"; }",c="$.wCall('"+this.renderScope().wQid()+"', "+c+");";return c},a.prototype.mustacheRender=function(){var a,b,c,d,e,f,g,h;e=this.template(),a=this.wCallRenderer,b=$.extend({},this.renderScope(),{wCall:function(){return a}},this.renderData()),d={},h=this.partials();for(f=0,g=h.length;f<g;f++)c=h[f],b[c.wName()]=c.render(),d[c.wName()]="{{{"+c.wName()+"}}}";return Mustache.to_html(e,b,d)},a.prototype._normalizePartials=function(a){var b,c,d,e,f,g,h;(g=(d=this.options).partials)!=null?g:d.partials=[],b=[],h=this.options.partials;for(e=0,f=h.length;e<f;e++)c=h[e],typeof c==="string"?(this[c]=this._buildPartial(c,a),b.push(this[c])):b.push(c);return this.options.partials=b},a.prototype._buildPartial=function(b,c){var d;d={partials:[],renderScope:function(a){return a.wParent().wParent()}};return new a($.extend({},c,d))};return a}()},b["./waw"]=function(a){a.Signal=c("./signal").Signal,a.Brick=c("./brick").Brick,a.Cell=c("./cell").Cell,a.SM=c("./sm").SM,a.View=c("./view").View,a.Helpers=c("./helpers").Helpers,$(document).ready(function(){return $.extend($,new a.Helpers)})},c("./waw")}).call(this,Waw)